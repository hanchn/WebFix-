## 1. 概念区分

### 1.1 回流（Reflow）

> **回流**（也叫布局 Layout）：是指**元素的几何属性发生变化**，导致浏览器必须重新计算元素的位置、大小、形状等，甚至可能影响其它元素。
> 例如：添加/删除元素、元素尺寸/位置/字体大小变化、窗口尺寸变化等。

* 触发回流的典型操作：改变width、height、padding、margin、border、display、position、字体大小、内容变化、DOM结构变化、页面初始化等。

### 1.2 重绘（Repaint）

> **重绘**：指的是**元素的外观样式发生变化**，但**几何属性没变**，只需要重新渲染颜色、背景、阴影等，而不用重新计算布局。
> 例如：改变color、background-color、visibility、outline、box-shadow等。

* 重绘通常比回流开销小很多，因为只改“外观”，不需要全局布局计算。

---

## 2. 关系和差异

* **回流必定引发重绘**，但重绘不一定会导致回流。
* 回流开销大，性能影响明显，频繁回流容易卡顿。
* 重绘只影响渲染层，代价较小。

---

## 3. 实际开发中如何检测？

### 浏览器工具检测

* **Chrome DevTools**

  1. 打开F12开发者工具
  2. 在“Performance（性能）”面板录制页面操作
  3. 查看瀑布流时间轴，“Layout”即回流，“Paint”即重绘

* **Rendering工具**

  1. 打开DevTools，切换到“Rendering”子面板
  2. 勾选“Paint flashing”，页面发生重绘时会有闪烁提示
  3. 部分版本支持“Layout Shift Regions”，能直观看到回流区域

### 代码检测

* 在JS中可用`console.time`和`console.timeEnd`包裹高频DOM操作，检测耗时
* 使用第三方库（如stats.js）监控帧率和页面流畅度

---

## 4. 优化建议和实战技巧

### 4.1 避免高频操作触发回流

* **合并DOM操作**：用DocumentFragment/字符串拼接/批量插入等，减少多次DOM改动。
* **减少逐条style设置**：建议用class切换或一次性设置多个样式。
* **缓存属性**：频繁读取如offsetTop/offsetHeight等“强制回流属性”，建议一次性读取并缓存。
* **避免逐帧操作布局属性**：如动画、滚动监听等，合并处理。

### 4.2 动画优化

* **使用transform/opacity做动画**，只触发合成层，不会回流
* 避免用top/left/width/height做频繁动画

### 4.3 离线处理

* **离线更新**：元素操作先脱离文档流（如display\:none），操作完成后再插回页面
* **虚拟列表/懒加载**：减少大DOM渲染和回流压力

---

## 5. 总结口诀

* **回流=布局变化，代价大**；**重绘=外观变化，代价小**
* **回流必重绘，重绘不回流**
* **合并DOM操作，用class批量更新，动画尽量用transform/opacity**

